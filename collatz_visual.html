<!DOCTYPE html>
<html lang="en">
<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.sng {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.def {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collatz Conjecture Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <style>
      body {
          margin: 0;
          padding: 0;
          background-color: #000;
          overflow: hidden; 
          height: 100vh;
          width: 100vw;
          position: fixed; 
      }
      
      svg {
          display: block;
          width: 100vw;
          height: 100vh;
          max-width: 100%;
          max-height: 100%;
      }
    </style>
</head>
<body>

    <script id="collatz-logic">
        // Configuration
        let canvas_width = window.innerWidth;
        let canvas_height = window.innerHeight;
        
        const angle_even = 5.0 * Math.PI / 180;
        const angle_odd = -10.0 * Math.PI / 180;
        
        const draw_duration = 1500; 
        const fade_duration = 15000; 
        const path_limit = 300; 
        const branch_length_multiplier = 40;

        const min_sequence_length = 1;
        const max_sequence_length = 400; 
        const color_start = "#FF8100";
        const color_end = "#FFEAD5";

        function getPathData(n) {
            let sequence_list = [n];
            let current_val = n;
            while (current_val > 1) {
                if (current_val % 2 === 0) current_val /= 2;
                else current_val = 3 * current_val + 1;
                sequence_list.push(current_val);
            }
            const total_steps = sequence_list.length;
            sequence_list.reverse(); 

            let current_x = 0;
            let current_y = 0;
            
            // CHANGED: Angle set to -90 degrees so it grows UPWARDS
            let current_angle = -90 * Math.PI / 180; 
            
            let point_coords = [{x: current_x, y: current_y}];

            for (let i = 1; i < sequence_list.length; i++) {
                const val_item = sequence_list[i];
                const turn_angle = (val_item % 2 === 0) ? angle_even : angle_odd;
                current_angle += turn_angle;
                const segment_len = branch_length_multiplier / Math.log(val_item + 2); 
                current_x += segment_len * Math.cos(current_angle);
                current_y += segment_len * Math.sin(current_angle);
                point_coords.push({x: current_x, y: current_y});
            }
            return { points: point_coords, length: total_steps };
        }
    </script>

    <script id="d3-visualization">
        const svg_container = d3.select("body").append("svg")
            .attr("viewBox", `0 0 ${canvas_width} ${canvas_height}`)
            .attr("preserveAspectRatio", "xMaxYMin meet")
            .style("background", "#000");

        // CHANGED: Y set to (canvas_height - 50) to start at the bottom
        const main_group = svg_container.append("g")
            .attr("transform", `translate(${canvas_width / 2}, ${canvas_height - 50})`);

        const line_generator = d3.line()
            .x(d => d.x)
            .y(d => d.y)
            .curve(d3.curveBundle.beta(0.85));

        const color_scale = d3.scaleSequential()
            .domain([min_sequence_length, max_sequence_length])
            .interpolator(d3.interpolateRgb(color_start, color_end));

        function animateNext() {
            const current_paths = main_group.selectAll("path");
            if (current_paths.size() > path_limit) {
                current_paths.filter((d, i) => i < (current_paths.size() - path_limit)).remove();
            }

            const random_seed = Math.floor(Math.random() * 500000) + 1;
            const path_result = getPathData(random_seed);

            const path_element = main_group.append("path")
                .datum(path_result.points)
                .attr("fill", "none")
                .attr("stroke", color_scale(path_result.length))
                .attr("stroke-width", 1.2)
                .attr("opacity", 0.4)
                .attr("stroke-linecap", "round")
                .attr("d", line_generator);

            const total_length = path_element.node().getTotalLength();

            path_element
                .attr("stroke-dasharray", total_length + " " + total_length)
                .attr("stroke-dashoffset", total_length)
                .transition()
                .duration(draw_duration)
                .ease(d3.easeLinear)
                .attr("stroke-dashoffset", 0)
                .on("end", () => {
                    path_element.transition()
                        .duration(fade_duration)
                        .attr("opacity", 0)
                        .remove();
                    setTimeout(animateNext, 150);
                });
        }

        window.onload = () => {
            for(let i = 0; i < 4; i++) setTimeout(animateNext, i * 500);
        };

        window.onresize = () => {
            canvas_width = window.innerWidth;
            canvas_height = window.innerHeight;
            svg_container.attr("viewBox", `0 0 ${canvas_width} ${canvas_height}`);
            // CHANGED: Update resize logic to keep it at the bottom center
            main_group.attr("transform", `translate(${canvas_width / 2}, ${canvas_height - 50})`);
        };
    </script>
</body>
</html>
